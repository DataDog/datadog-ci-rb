module Datadog
  module CI
    module TestOptimisation
      class DependenciesTracker
        CONSTANT_WRITE_NODE_CLASSES: Array[untyped]
        CONSTANT_PATH_WRITE_NODE_CLASSES: Array[untyped]
        MODULE_OR_CLASS_NODE_CLASSES: Array[untyped]

        @root: String
        @bundle_location: String?
        @constant_definitions: Hash[String, String]
        @constants_used_by_file: Hash[String, Set[String]]
        @dependencies_cache: Hash[String, Set[String]]

        attr_reader bundle_location: String?
        attr_reader constant_definitions: Hash[String, String]
        attr_reader constants_used_by_file: Hash[String, Set[String]]

        def initialize: (?bundle_location: String?) -> void

        def load: () -> void

        def fetch_dependencies: (String source_path) -> Set[String]

        private

        attr_reader root: String
        attr_reader dependencies_cache: Hash[String, Set[String]]

        def trackable_file?: (String? path) -> bool

        def each_ruby_file: () { (String) -> void } -> void

        def process_ast: (String file_path, untyped node) -> void

        def walk_ast: (untyped node, Array[String] namespace) { (Hash[Symbol, untyped]) -> void } -> void

        def constant_definition_name: (untyped node, Array[String] namespace) -> String?

        def constant_reference_node?: (untyped node) -> bool

        def constant_write_node?: (untyped node) -> bool

        def constant_path_write_node?: (untyped node) -> bool

        def module_or_class_node?: (untyped node) -> bool

        def extract_constant_path_name: (untyped node) -> String?

        def definition_target_node: (untyped node) -> untyped

        def skip_definition_child?: (untyped node, untyped child) -> bool

        def qualified_constant_name: (String? raw_name, Array[String] namespace_stack) -> String?

        def absolute_constant_reference?: (String name) -> bool

        def constant_reference_candidates: (String raw_name, Array[String] namespace_stack) -> Array[String]
      end
    end
  end
end

